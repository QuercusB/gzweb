<script type="text/javascript">

  function setMargins() {
      width = 780;
      containerWidth = $(".container").width();
      leftMargin = (containerWidth - width)/2;
      console.log(leftMargin, containerWidth, width)
      $(".task_info_group").css("marginLeft", leftMargin);
  }

  $(document).ready(function() {
    $('.task_info__item').on('click', function(e) {
      var item = $(this),
          dataItem = item.children('div').first();
      if (item.parents().hasClass('aside_startview')) {
        $('.task_info_group').removeClass('aside_startview');
        $('.task_info_group').addClass('aside_listview');
        $('.task_info__item').find('.icon').hide();
        $('.js--nav').removeClass("nav__start_view").addClass('nav__list_view');
        $(".task_info_group").css({"marginLeft": 0, "float": "left"});
      }

      $(".task_info__item").removeClass("active");
      item.addClass("active");
      $('.data-area')
        .animate({ opacity:1 }, 400, 'easeInCirc');

      timeout = setTimeout(function() {
        switch_to_list(dataItem.data("folder"));

        $('.data-area').css({ "z-index": "0" });
        $('section').fadeIn(1000);
      }, 600);
    });

    $(".logo-bar").on('click', function() {
      $('aside').addClass('aside_startview');
      $('.js--nav').removeClass("nav__list_view").addClass('nav__start_view');
      $('.task_info_group').removeClass('aside_listview');
      setMargins();
      $('section').hide();
      $('.task_info__item').find('.icon').fadeIn();
      $(".task_info__item").removeClass("active");
    });

    setMargins();
    $(window).resize(function() {
      if($('.task_info_group').hasClass('aside_startview')) {
        setMargins();
      }
    });

  });
</script>
<nav class="navbar navbar-fixed-top nav__start_view js--nav top_shift--20px">
  <div class="container">
    <div class="logo-bar">
  	  <img src="/assets/logo.jpg"/>
    </div>
    <div class="header-bar">
      <%= render 'user_control', user: @user %>
      <%# render 'task_info/task_summary', task_info: @task_info %>
      <div class="header-actions">
        <ul>
          <li><%= link_to t("actions.refresh"), "/", { :class => 'nav__buttons task-info-refresh ' } %></li>
          <li><%= link_to t("actions.new-task"), new_task_path(), { target: '_blank',:class => 'nav__buttons create-task-link' }  %></li>
          <li><%= link_to t("actions.new-long-task"), new_task_path(), { target: '_blank', class: 'nav__buttons window-link' }  %></li>
          <li><%= link_to t("actions.phones"), "http://01srvnsi.gz.local/GZPhoneBook/sait/страница1.html", { target: '_blank', class: 'nav__buttons' }  %></li>
        </ul>
      </div>
    </div>
  </div>
</nav>
<main class="container">
<%= render 'static_pages/test_task_info', task_info: @task_info %>
  <script id="task-template" type="text/x-jsrender">
    <div class="task-area" data-task-id="{{>task_id}}" data-id="{{>id}}">
      <div class="task-area-header">
        <div class="task-subject-area">
          <div class="task-subject">
            <div>{{>subject}}</div>
          </div>
          <div class="task-date">{{>date}}</div>
        </div>
        <div class="task-author-area">
          <div class="header"><%=t "task.author" %></div>
          <div class="task-author-name">{{>author_name}}</div>
          <div class="task-author-position">{{>author_position}}</div>
        </div>
        {{if deadline }}
        <div class="task-deadline-area">
          <div class="header"><%=t "task.deadline" %></div>
          <div class="task-deadline-date" data-value="{{>deadline_date}}">{{>deadline_date}}</div>
          <div class="task-deadline-time" data-value="{{>deadline_time}}">{{>deadline_time_till}}</div>
        </div>
        {{/if}}
      </div>
      <div class="task-content" data-value="{{>content}}">{{:html_content}}</div>
      {{if controler_name }}
        <div class="task-controler-area">
          <div class="header"><%=t "task.controller" %></div>
          <div class="task-controler-name">{{>controler_name}}</div>
          {{if controler_position }}
            <div class="task-controler-position">{{>controler_position}}</div>
          {{/if}}
        </div>
      {{/if}}
      {{if parent_document }}
        <div class="task-document-area">
          <div class="header"><%=t "task.document" %></div>
          <div class="task-document" data-id="{{>parent_document_id}}" data-name="{{>parent_document}}">{{>parent_document}}</div>
        </div>
      {{/if}}
      <div class="task-files-area">
      {{for files }}
        <a href="/file/{{>file_id}}" target="_blank" class="task-file-ref" data-value="{{>file_id}}" data-name="{{>filename}}">{{>filename}}</a>
      {{/for}}
	<div class="breaker"></div>
      </div>
      <div class="task-actions-area">
	{{if delegated_to }}
	<div class="task-delegated-area">
		<div class="header">Распределено:&nbsp;</div>
		<div class="task-delegated">{{>delegated_to}}</div>
	</div>
	{{/if}}
	<div class="task-actions">
	  <a class="task-action-delegate" href="#">Распределить</a>
	  <a class="task-action-complete" href="#">Завершить</a>
	  <div class="breaker"></div>
	</div>
	<div class="breaker"></div>
      </div>
    </div>
  </script>
  <section class="data-area">
    <div id="task-shadow">
    </div>
    <div id="task-list">
    </div>
  </section>
  </main>
  <div class="create-task-area">
    <%= render 'tasks/task_form', user: @user, quick_performers: @quick_performers %>
  </div>
</div>
